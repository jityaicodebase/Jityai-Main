<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JityAi ‚Äî Store Intelligence</title>
    <!-- Space Grotesk & JetBrains Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@800;900&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/reports.css">
    <style>
        nav {
            overflow: visible !important;
            height: auto !important;
            min-height: 80px;
        }

        .brand-logo-final {
            opacity: 0;
            animation: logoFadeIn 0.8s ease forwards;
        }

        @keyframes logoFadeIn {
            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <nav style="display: flex; justify-content: space-between; align-items: center;">
        <div class="brand" style="flex: 0 0 240px;">
            <span class="brand-logo-final" style="font-size: 36px; font-weight: 800; letter-spacing: -0.02em;">Jity<span
                    class="text-accent">A</span>I</span>
        </div>

        <div class="persona-switcher" style="margin: 0 auto;">
            <button class="persona-btn active" onclick="switchPersona('owner')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                    <path
                        d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z">
                    </path>
                </svg>
                Insights
            </button>
            <button class="persona-btn" onclick="switchPersona('tracker')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 2a10 10 0 0 1 10 10"></path>
                    <path d="M12 12 19 7"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
                Tracker
            </button>
            <button class="persona-btn" onclick="switchPersona('reports')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                Reports
            </button>
            <button class="persona-btn" onclick="switchPersona('manager')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                    <path d="m7.5 4.27 9 5.15"></path>
                    <path
                        d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z">
                    </path>
                    <path d="m3.3 7 8.7 5 8.7-5"></path>
                    <path d="M12 22V12"></path>
                </svg>
                Inventory
            </button>
        </div>

        <div class="store-nav"
            style="flex: 0 0 240px; display: flex; justify-content: flex-end; align-items: center; gap: 16px;">
            <button class="cart-badge" id="reorder-btn-nav" onclick="toggleCart()">
                <span>Reorder</span>
                <span class="cart-count" id="cart-count">0</span>
            </button>

            <button class="dark-mode-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>

            <button class="btn-ghost" onclick="logout()" title="Logout"
                style="margin-right: 12px; display: flex; align-items: center; gap: 6px; padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border); background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; font-weight: 600;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                <span>Logout</span>
            </button>

            <div id="store-label" class="store-badge" style="white-space: nowrap;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                    <circle cx="12" cy="7" r="4" />
                </svg>
                <span id="store-owner-name">Store Owner</span>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- FIRST-TIME ONBOARDING SCREEN -->
        <div id="onboarding-welcome" class="onboarding-screen" style="display: none;">
            <div class="onboarding-content">
                <div class="onboarding-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                        <polyline points="9 22 9 12 15 12 15 22" />
                    </svg>
                </div>
                <h1 class="onboarding-title">Welcome to JityAI!</h1>
                <p class="onboarding-subtitle">Let's set up your store in just a few minutes</p>

                <div class="onboarding-steps">
                    <div class="onboarding-step active">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Upload Your Inventory</h4>
                            <p>Import your current stock from Excel or CSV</p>
                        </div>
                    </div>
                    <div class="onboarding-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>AI Analyzes Your Data</h4>
                            <p>We categorize products and calculate insights</p>
                        </div>
                    </div>
                    <div class="onboarding-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Get Smart Recommendations</h4>
                            <p>Start receiving reorder alerts and insights</p>
                        </div>
                    </div>
                </div>

                <div class="onboarding-cta">
                    <button class="btn btn-primary btn-large" onclick="openModal('onboard-modal')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="17 8 12 3 7 8" />
                            <line x1="12" y1="3" x2="12" y2="15" />
                        </svg>
                        Start Onboarding
                    </button>
                    <p class="onboarding-hint">Upload your catalog to begin analysis</p>
                </div>

                <div class="onboarding-help">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                        <line x1="12" y1="17" x2="12.01" y2="17" />
                    </svg>
                    <span>Need help? <a href="#" onclick="showSampleFormat()">Download sample format</a></span>
                </div>
            </div>
        </div>

        <!-- --- OWNER VIEW --- -->
        <div id="owner-view" class="view-content active">
            <div class="impact-bar" id="owner-impact">
                <div class="summary-item">
                    <div class="stat-label">Sales Protected</div>
                    <div class="stat-val" style="color: var(--accent-green);" id="owner-sales-prot">‚Çπ0</div>
                </div>
                <div class="summary-item">
                    <div class="stat-label">Blocked Capital</div>
                    <div class="stat-val" style="color: var(--accent-yellow);" id="owner-cash-block">‚Çπ0</div>
                </div>
            </div>

            <div style="margin-bottom: 48px; text-align: center;">
                <h1 style="font-size: 32px; margin-bottom: 12px;">Strategic Insights Hub</h1>
                <p style="color: hsl(var(--secondary)); margin: 8px 0 0 0; font-size: 16px;">AI-driven recommendations
                    for capital efficiency, stock health, and revenue protection.</p>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 24px;">
                <h2 style="margin: 0;">Priority Business Actions</h2>
                <div class="insight-nav-bar" id="recommendation-filter-bar"
                    style="display: flex; gap: 8px; background: var(--bg-secondary); padding: 4px; border-radius: 12px; border: 1px solid var(--border);">
                    <button class="insight-nav-btn active" data-category="ALL"
                        onclick="filterRecommendations('ALL')">All</button>
                    <button class="insight-nav-btn" data-category="BUY_MORE"
                        onclick="filterRecommendations('BUY_MORE')">Buy More</button>
                    <button class="insight-nav-btn" data-category="BUY_LESS"
                        onclick="filterRecommendations('BUY_LESS')">Buy Less</button>
                    <button class="insight-nav-btn" data-category="MONITOR"
                        onclick="filterRecommendations('MONITOR')">Monitor</button>
                </div>
            </div>
            <div id="decision-list" class="grid">
                <div class="loading-shimmer" style="grid-column: 1/-1"></div>
            </div>
            <div id="recommendations-pagination-container" style="display: flex; justify-content: center; width: 100%;">
            </div>
        </div>

        <!-- --- ANALYSIS TRACKER VIEW --- -->
        <div id="tracker-view" class="view-content">
            <div class="impact-bar" id="tracker-impact">
                <div class="summary-item">
                    <div class="stat-label">Capital Saved</div>
                    <div class="stat-val" style="color: var(--accent-green);" id="tracker-capital-saved">‚Çπ0</div>
                    <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">By accepting AI
                        suggestions</div>
                </div>
                <div class="summary-item">
                    <div class="stat-label">Potential Revenue Lost</div>
                    <div class="stat-val" style="color: var(--accent-red);" id="tracker-revenue-lost">‚Çπ0</div>
                    <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">From ignored
                        recommendations</div>
                </div>
            </div>

            <div class="ops-header" style="margin-top: 32px;">
                <div>
                    <h1 style="margin: 0; font-size: 24px;">AI Analysis Tracking</h1>
                    <p style="color: var(--text-secondary); margin: 4px 0 0 0;">Review how your decisions and AI
                        suggestions performed over time.</p>
                </div>
                <div
                    style="display: flex; gap: 8px; background: var(--bg-secondary); padding: 4px; border-radius: 12px; border: 1px solid var(--border);">
                    <button class="insight-nav-btn active" data-outcome="ALL"
                        onclick="filterTrackerOutcome('ALL')">All</button>
                    <button class="insight-nav-btn" data-outcome="ACCEPTED"
                        onclick="filterTrackerOutcome('ACCEPTED')">Accepted</button>
                    <button class="insight-nav-btn" data-outcome="REJECTED"
                        onclick="filterTrackerOutcome('REJECTED')">Rejected</button>
                </div>
            </div>

            <div class="table-container" style="margin-top: 24px;">
                <table>
                    <thead>
                        <tr>
                            <th>REASONING & PRODUCT</th>
                            <th>YOUR FEEDBACK</th>
                            <th>AI RECOMMENDATION</th>
                            <th>VERIFIED REALITY</th>
                            <th style="text-align: right;">DATE</th>
                        </tr>
                    </thead>
                    <tbody id="tracker-body">
                        <tr>
                            <td colspan="5" class="empty">Loading tracking history...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- --- MANAGER VIEW --- -->
        <div id="manager-view" class="view-content">
            <div class="ops-header">
                <div>
                    <h1 style="margin: 0; font-size: 24px;">Operations Hub</h1>
                    <p style="color: var(--text-secondary); margin: 4px 0 0 0;">Manage catalog, stock, and sync status.
                    </p>
                </div>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <div class="location-box">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                        <span id="current-location-display">My Store</span>
                    </div>
                    <button class="btn btn-outline" onclick="openModal('sync-modal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" style="margin-right: 6px;">
                            <polyline points="23 4 23 10 17 10" />
                            <polyline points="1 20 1 14 7 14" />
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
                        </svg>
                        Sync Data
                    </button>
                </div>
            </div>

            <div class="grid">
                <div class="card">
                    <div class="stat-label">Catalog Health</div>
                    <div class="stat-val" id="ops-catalog-total">0</div>
                    <div style="font-size: 13px; color: var(--text-secondary);" id="ops-catalog-categorized">0/0
                        Categorized</div>
                </div>
                <div class="card">
                    <div class="stat-label">Stock Alerts</div>
                    <div class="stat-val" style="color: var(--danger);" id="ops-low-stock">0</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">SKUs below safety limit</div>
                </div>
                <div class="card">
                    <div class="stat-label">Inventory Value</div>
                    <div class="stat-val" style="color: var(--accent-green);" id="ops-inventory-value">‚Çπ0</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">Total retail value on shelf</div>
                </div>
                <div class="card">
                    <div class="stat-label">Sync Status</div>
                    <div class="stat-val" id="ops-sync-status">N/A</div>
                    <div style="font-size: 13px; color: var(--text-secondary);" id="ops-sync-time">Last: Never</div>
                </div>
            </div>

            <div class="ops-header" style="margin-top: 48px;">
                <h2 style="font-size: 14px; text-transform: uppercase;">Recent Inventory Activity</h2>
                <div style="display: flex; gap: 12px;">
                    <input type="text" id="inventory-search" placeholder="Search product or SKU..."
                        class="filter-control" style="min-width: 200px;" onkeyup="filterInventory()">

                    <select id="inventory-filter-category" onchange="filterInventory()" class="filter-control">
                        <option value="">All Categories</option>
                    </select>

                    <select id="inventory-filter-stock" onchange="filterInventory()" class="filter-control">
                        <option value="">All Stock Status</option>
                        <option value="low">Low Stock (‚â§10)</option>
                        <option value="out">Out of Stock (0)</option>
                        <option value="healthy">Healthy Stock</option>
                    </select>

                    <button class="btn btn-outline" style="padding: 8px 16px; font-size: 13px;"
                        onclick="exportInventory()">Export CSV</button>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>SKU</th>
                            <th>Product</th>
                            <th>Category</th>
                            <th>Stock</th>
                            <th>CP</th>
                            <th>SP</th>
                            <th>Last Sync</th>
                            <th style="text-align: right;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-body">
                        <tr>
                            <td colspan="8" class="empty">Scanning shelves...</td>
                        </tr>
                    </tbody>
                </table>
                <div id="view-all-container"
                    style="padding: 16px; text-align: center; border-top: 1px solid var(--border); display: none;">
                    <button class="btn btn-outline" style="font-size: 12px;" onclick="showFullRegistry()">View All
                        SKUs</button>
                </div>
            </div>
        </div>

        <!-- --- FULL REGISTRY VIEW --- -->
        <div id="registry-view" class="view-content">
            <div class="ops-header">
                <div>
                    <button class="btn btn-outline" style="padding: 8px 16px; margin-bottom: 16px;"
                        onclick="switchPersona('manager')">‚Üê Back to Hub</button>
                    <h1 style="margin: 0; font-size: 24px;">Master Registry</h1>
                </div>
            </div>
            <div class="table-container">
                <div style="padding: 16px; border-bottom: 1px solid var(--border);">
                    <input type="text" id="full-registry-search" placeholder="Filter by name or SKU..."
                        style="width: 100%; max-width: 400px; background: var(--bg-tertiary); border: 1px solid var(--border); color: white; padding: 12px 16px; border-radius: 12px;"
                        onkeyup="filterFullRegistry()">
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>SKU</th>
                            <th>Product</th>
                            <th>Category</th>
                            <th>Stock</th>
                            <th>CP</th>
                            <th>SP</th>
                            <th>Health</th>
                            <th style="text-align: right;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="full-registry-body"></tbody>
                </table>
            </div>
        </div>
    </div>


    <!-- --- REPORTS VIEW --- -->
    <div id="reports-view" class="view-content" style="max-width: 1400px; margin: 0 auto; padding: 0 24px;">

        <!-- Header -->
        <div
            style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 32px; flex-wrap: wrap; gap: 16px;">
            <div>
                <h1 style="font-size: 26px; margin: 0 0 8px 0; font-weight: 800;">Reports & Analytics</h1>
                <p style="color: hsl(var(--secondary)); margin: 0; font-size: 14px;">Real-time inventory intelligence
                    across your store.</p>
            </div>

            <!-- Time Period Filter -->
            <div id="report-time-filter"
                style="display: flex; gap: 8px; background: hsl(var(--input)); padding: 4px; border-radius: 12px;">
                <button class="time-btn active" onclick="setReportPeriod(7)">7 Days</button>
                <button class="time-btn" onclick="setReportPeriod(14)">14 Days</button>
                <button class="time-btn" onclick="setReportPeriod(30)">30 Days</button>
                <button class="time-btn" onclick="setReportPeriod(365)">Yearly</button>
            </div>
        </div>

        <!-- SECTION: Urgent Alerts -->
        <div style="margin-bottom: 40px;">
            <div
                style="font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em; color: hsl(var(--danger)); margin-bottom: 16px; display: flex; align-items: center; gap: 10px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path
                        d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                    <line x1="12" y1="9" x2="12" y2="13" />
                    <line x1="12" y1="17" x2="12.01" y2="17" />
                </svg>
                Urgent Alerts
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;">
                <!-- Reorder Now -->
                <div class="report-card-v2 danger" onclick="loadReport('reorder-now')">
                    <div class="report-icon danger"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
                        </svg></div>
                    <div class="report-info">
                        <h4>Reorder Now</h4>
                        <p>Items running out within lead time</p>
                    </div>
                    <svg class="report-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6" />
                    </svg>
                </div>
                <!-- Emergency Refill -->
                <div class="report-card-v2 danger" onclick="loadReport('emergency-refill')">
                    <div class="report-icon danger"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                        </svg></div>
                    <div class="report-info">
                        <h4>Emergency Refill</h4>
                        <p>Zero stock with recent demand</p>
                    </div>
                    <svg class="report-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6" />
                    </svg>
                </div>
                <!-- Buffer Breach -->
                <div class="report-card-v2 warning" onclick="loadReport('buffer-breach')">
                    <div class="report-icon warning"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                        </svg></div>
                    <div class="report-info">
                        <h4>Buffer Breach</h4>
                        <p>Stock below safety threshold</p>
                    </div>
                    <svg class="report-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6" />
                    </svg>
                </div>
            </div>
        </div>

        <!-- SECTION: Planning Reports -->
        <div style="margin-bottom: 40px;">
            <div
                style="font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em; color: hsl(var(--info)); margin-bottom: 16px; display: flex; align-items: center; gap: 10px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                    <line x1="16" y1="2" x2="16" y2="6" />
                    <line x1="8" y1="2" x2="8" y2="6" />
                    <line x1="3" y1="10" x2="21" y2="10" />
                </svg>
                Planning & Forecasting
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;">
                <!-- Weeks of Supply -->
                <div class="report-card-v2" onclick="loadReport('weeks-of-supply')">
                    <div class="report-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="10" />
                            <polyline points="12 6 12 12 16 14" />
                        </svg></div>
                    <div class="report-info">
                        <h4>Weeks of Supply</h4>
                        <p>Coverage duration for each SKU</p>
                    </div>
                    <svg class="report-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6" />
                    </svg>
                </div>
                <!-- Frequent Stockouts -->
                <div class="report-card-v2" onclick="loadReport('frequent-stockouts')">
                    <div class="report-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M18 6L6 18" />
                            <path d="M6 6l12 12" />
                        </svg></div>
                    <div class="report-info">
                        <h4>Frequent Stockouts</h4>
                        <p>Items that repeatedly hit zero</p>
                    </div>
                    <svg class="report-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6" />
                    </svg>
                </div>
                <!-- Dead Stock -->
                <div class="report-card-v2" onclick="loadReport('no-sales')">
                    <div class="report-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M23 4v6h-6" />
                            <path d="M1 20v-6h6" />
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
                        </svg></div>
                    <div class="report-info">
                        <h4>Dead Stock</h4>
                        <p>No sales in selected period</p>
                    </div>
                    <svg class="report-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6" />
                    </svg>
                </div>
                <!-- Overstocked -->
                <div class="report-card-v2" onclick="loadReport('overstocked-slow-moving')">
                    <div class="report-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
                            <line x1="12" y1="22.08" x2="12" y2="12" />
                        </svg></div>
                    <div class="report-info">
                        <h4>Overstocked & Slow</h4>
                        <p>Blocked capital in slow movers</p>
                    </div>
                    <svg class="report-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6" />
                    </svg>
                </div>
            </div>
        </div>

        <!-- SECTION: Analytics -->
        <div style="margin-bottom: 40px;">
            <div
                style="font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em; color: hsl(var(--success)); margin-bottom: 16px; display: flex; align-items: center; gap: 10px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <line x1="18" y1="20" x2="18" y2="10" />
                    <line x1="12" y1="20" x2="12" y2="4" />
                    <line x1="6" y1="20" x2="6" y2="14" />
                </svg>
                Analytics & Valuation
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;">
                <!-- Inventory Position -->
                <div class="report-card-v2" onclick="loadReport('inventory-position')">
                    <div class="report-icon success"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                            <polyline points="9 22 9 12 15 12 15 22" />
                        </svg></div>
                    <div class="report-info">
                        <h4>Inventory Position</h4>
                        <p>Full valuation overview</p>
                    </div>
                    <svg class="report-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6" />
                    </svg>
                </div>
                <!-- ISR -->
                <div class="report-card-v2" onclick="loadReport('isr')">
                    <div class="report-icon success"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23" />
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
                        </svg></div>
                    <div class="report-info">
                        <h4>Inventory-to-Sales Ratio</h4>
                        <p>Capital efficiency metric</p>
                    </div>
                    <svg class="report-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6" />
                    </svg>
                </div>
                <!-- Aging -->
                <div class="report-card-v2" onclick="loadReport('aging-bucket')">
                    <div class="report-icon success"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="10" />
                            <path d="M12 6v6l4 2" />
                        </svg></div>
                    <div class="report-info">
                        <h4>Aging Analysis</h4>
                        <p>Inventory by age buckets</p>
                    </div>
                    <svg class="report-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6" />
                    </svg>
                </div>
            </div>
        </div>

        <!-- Report Output -->
        <div id="report-loader" style="display: none; text-align: center; padding: 60px; color: hsl(var(--secondary));">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                style="animation: spin 1s linear infinite;">
                <path
                    d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83" />
            </svg>
            <p style="margin-top: 16px;">Generating report...</p>
        </div>
        <style>
            @keyframes spin {
                100% {
                    transform: rotate(360deg);
                }
            }
        </style>

        <div id="report-output-container"
            style="display:none; background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 16px; overflow: hidden; margin-top: 24px;">

            <!-- Report Header -->
            <div class="report-output-header">
                <div class="report-header-left">
                    <h2 id="report-title">Report Title</h2>
                    <span id="report-meta" class="report-meta">0 items ‚Ä¢ Generated just now</span>
                </div>
                <div class="report-header-actions">
                    <button class="btn-export" onclick="exportReportToExcel()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="7 10 12 15 17 10" />
                            <line x1="12" y1="15" x2="12" y2="3" />
                        </svg>
                        Export Excel
                    </button>
                    <button class="btn-close-report"
                        onclick="document.getElementById('report-output-container').style.display='none'">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18" />
                            <line x1="6" y1="6" x2="18" y2="18" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Report Table -->
            <div class="report-table-wrapper">
                <table id="report-table" class="report-table">
                    <!-- Dynamic Header/Body -->
                </table>
            </div>

            <!-- Report Footer -->
            <div class="report-output-footer">
                <span class="report-disclaimer">‚ö†Ô∏è Reports are diagnostic only. Data based on selected time
                    period.</span>
            </div>
        </div>
    </div>

    <!-- --- CART PANEL --- -->
    <div id="cart-panel" class="cart-panel">
        <div class="cart-header">
            <h2>üõí Reorder Summary</h2>
            <button class="close-cart-btn" onclick="toggleCart()">‚úï</button>
        </div>

        <div id="cart-items" class="cart-items-container">
            <!-- Items via JS -->
        </div>

        <div class="cart-footer">
            <div class="cart-summary">
                <div class="summary-stats">
                    <span class="total-label">Subtotal (<span id="cart-total-items">0</span> items)</span>
                    <span class="total-value" id="cart-total-cost">‚Çπ0</span>
                </div>
            </div>
            <div class="cart-actions">
                <button class="btn btn-generate-po" onclick="generatePO()">üìÑ Generate Purchase Order</button>
                <button class="btn btn-clear-cart" onclick="clearCart()">Clear All</button>
            </div>
        </div>
    </div>

    <!-- --- AGENT STATUS BAR --- -->
    <div id="agent-status-bar" class="agent-status-bar">
        <div class="agent-icon">ü§ñ</div>
        <div class="agent-info">
            <div class="agent-name" id="agent-name">JityAi</div>
            <div class="agent-task" id="agent-task">Sleeping...</div>
        </div>
        <div class="agent-progress">
            <div id="agent-progress-bar" class="agent-progress-bar"></div>
        </div>
        <div style="font-size: 12px; font-weight: 700; min-width: 35px;" id="agent-progress-text">0%</div>
    </div>

    <!-- --- MODALS --- -->

    <!-- Onboard Modal -->
    <div class="modal-overlay" id="onboard-modal-overlay">
        <div class="modal">
            <h2 style="margin-top: 0;">Store Onboarding</h2>
            <p style="color: var(--text-secondary); margin-bottom: 24px;">Complete your store setup by uploading your
                master product catalog.</p>

            <div id="onboard-name-container" style="margin-bottom: 20px;">
                <label class="modal-label">STORE NAME</label>
                <input type="text" id="onboard-name" class="modal-input" placeholder="e.g. Mumbai Central Depot">
            </div>

            <div id="onboard-location-container" style="margin-bottom: 24px;">
                <label class="modal-label">STORE LOCATION</label>
                <input type="text" id="onboard-location" class="modal-input" placeholder="e.g. Bandra West, Mumbai">
            </div>

            <div class="upload-zone" onclick="document.getElementById('onboard-file').click()"
                style="padding: 40px 20px;">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="hsl(var(--accent))"
                    stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                    style="margin-bottom: 20px; opacity: 0.8;">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="12" y1="18" x2="12" y2="12"></line>
                    <polyline points="9 15 12 12 15 15"></polyline>
                </svg>
                <div id="onboard-file-name" style="font-weight: 700; font-size: 16px; color: hsl(var(--foreground));">
                    Select Catalog File</div>
                <div style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
                    or <span style="color: hsl(var(--accent)); text-decoration: underline; cursor: pointer;">click to
                        browse</span>
                </div>
                <div style="font-size: 11px; color: var(--text-secondary); margin-top: 16px; opacity: 0.7;">
                    Supports Name, SKU, Stock, Cost, and Price
                </div>
                <input type="file" id="onboard-file" style="display: none;" accept=".csv,.xlsx,.xls"
                    onchange="handleFileSelect('onboard-file', 'onboard-file-name')">
            </div>

            <div style="display: flex; gap: 12px; margin-top: 32px;">
                <button class="btn btn-outline" style="flex: 1" onclick="closeModal('onboard-modal')">Cancel</button>
                <button class="btn btn-primary" style="flex: 2" onclick="submitOnboard()">Launch Setup</button>
            </div>
        </div>
    </div>

    <!-- Sync Modal -->
    <div class="modal-overlay" id="sync-modal-overlay">
        <div class="modal">
            <h2 style="margin-top: 0;">Stock Refresh</h2>
            <p style="color: var(--text-secondary); margin-bottom: 24px;">Update your current inventory levels to
                refresh AI analysis.</p>

            <div class="upload-zone" onclick="document.getElementById('sync-file').click()"
                style="margin-top: 24px; padding: 40px 20px;">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="hsl(var(--accent))"
                    stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                    style="margin-bottom: 20px; opacity: 0.8;">
                    <path d="M21 2v6h-6"></path>
                    <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
                    <path d="M3 22v-6h6"></path>
                    <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
                </svg>
                <div id="sync-file-name" style="font-weight: 700; font-size: 16px; color: hsl(var(--foreground));">Drop
                    Stock Report Here</div>
                <div style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
                    or <span style="color: hsl(var(--accent)); text-decoration: underline; cursor: pointer;">click to
                        browse</span>
                </div>
                <input type="file" id="sync-file" style="display: none;" accept=".csv,.xlsx,.xls"
                    onchange="handleFileSelect('sync-file', 'sync-file-name')">
            </div>

            <div style="display: flex; gap: 12px; margin-top: 32px;">
                <button class="btn btn-outline" style="flex: 1" onclick="closeModal('sync-modal')">Cancel</button>
                <button class="btn btn-primary" style="flex: 2" onclick="submitSync()">Refresh stock</button>
            </div>
        </div>
    </div>


    <!-- Edit Modal -->
    <div class="modal-overlay" id="edit-modal-overlay">
        <div class="modal">
            <h2 style="margin: 0;">Edit Inventory Data</h2>
            <p id="edit-sku-id"
                style="font-family: monospace; font-size: 12px; color: var(--accent-blue); margin: 8px 0 24px 0;"></p>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
                <div style="grid-column: 1/-1">
                    <label class="modal-label">PRODUCT NAME</label>
                    <input type="text" id="edit-name" class="modal-input" placeholder="Loading product name...">
                </div>
                <div>
                    <label class="modal-label">STOCK QUANTITY</label>
                    <input type="number" id="edit-stock" class="modal-input" placeholder="0">
                </div>
                <div>
                    <label class="modal-label">CATEGORY</label>
                    <input type="text" id="edit-category" class="modal-input" placeholder="General">
                </div>
                <div>
                    <label class="modal-label">COST PRICE (‚Çπ)</label>
                    <input type="number" id="edit-cp" class="modal-input" placeholder="0.00">
                </div>
                <div>
                    <label class="modal-label">SELLING PRICE (‚Çπ)</label>
                    <input type="number" id="edit-sp" class="modal-input" placeholder="0.00">
                </div>
                <div style="grid-column: 1/-1">
                    <label class="modal-label">REASON FOR CHANGE (DEMO)</label>
                    <select id="edit-reason" class="modal-input">
                        <option value="">Select a reason</option>
                        <option value="Manual Correction">Manual Correction</option>
                        <option value="Damaged Stock">Damaged Stock</option>
                        <option value="Return to Vendor">Return to Vendor</option>
                    </select>
                </div>
            </div>

            <div style="display: flex; gap: 12px; margin-top: 32px;">
                <button class="btn btn-outline" style="flex: 1" onclick="closeModal('edit-modal')">Discard</button>
                <button class="btn btn-primary" style="flex: 2" onclick="submitEdit()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Rejection Modal -->
    <div class="modal-overlay" id="rejection-modal-overlay">
        <div class="modal">
            <h2 style="margin-top: 0;">Skip Recommendation</h2>
            <p style="color: var(--text-secondary); margin-bottom: 24px;">Please help Martin AI learn. Why are you
                ignoring this reorder suggestion?</p>

            <div class="rejection-options">
                <button class="rejection-option" onclick="selectRejection(this, 'I already have enough stock')">
                    üì¶ I already have enough stock
                </button>
                <button class="rejection-option" onclick="selectRejection(this, 'Price is too high right now')">
                    üí∞ Price is too high right now
                </button>
                <button class="rejection-option" onclick="selectRejection(this, 'Low demand expected')">
                    üìâ Low demand expected
                </button>
                <button class="rejection-option" onclick="selectRejection(this, 'Vendor issues / Not available')">
                    üöö Vendor issues / Not available
                </button>
            </div>

            <div style="margin-bottom: 24px;">
                <label
                    style="display: block; font-size: 11px; margin-bottom: 8px; color: var(--text-secondary);">ADDITIONAL
                    NOTE (OPTIONAL)</label>
                <textarea id="rejection-custom" placeholder="Any other specific reason..."
                    style="width: 100%; background: var(--bg-tertiary); border: 1px solid var(--border); color: white; padding: 12px; border-radius: 12px; height: 80px; resize: none; font-family: inherit; font-size: 14px;"></textarea>
            </div>

            <div style="display: flex; gap: 12px;">
                <button class="btn btn-outline" style="flex: 1" onclick="closeModal('rejection-modal')">Cancel</button>
                <button class="btn btn-primary" style="flex: 2" onclick="submitRejection()">Submit Feedback</button>
            </div>
        </div>
    </div>


    <script src="/auth.js"></script>
    <script src="js/app.js"></script>
    <!-- --- NOTIFICATIONS --- -->
    <div id="notifications-container" class="notifications-container"></div>
</body>

</html>